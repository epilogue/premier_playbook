---
  - name: PLAY BOOTSTRAP
    hosts: all
    become: true

    vars: 
      liste_users:
        testuser1:
          state: present
          shell: /bin/bash
        testuser2:
          state: present
          shell: /sbin/nologin

    tasks:
      - name: Création d'un user standard avec groupe
        ansible.builtin.user:
          name: formation
          state: present
          shell: /bin/bash
          groups: "{{ sudogrp }}"

      - name: Création d'utilisateurs standards
        ansible.builtin.user:
          name: "{{ item.key }}"
          state: "{{ item.value.state }}"
          shell: "{{ item.value.shell }}"
          password: "{{ lookup('password', 'credential'
            + '/'
            + item.key
            + '.password length=15') | password_hash('sha512') }}"
          update_password: on_create
        loop: "{{ liste_users | dict2items }}"
          


  